<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="js/underscore-min.js"></script>
		<script type="text/javascript" src="js/backbone-min.js"></script>
		
		<script type="text/javascript">
			$(document).ready(
				function(){
					myInviteeCollection = new InviteeCollection();
					invitee = new InviteeView(
						{
							el:"#invitee",
							collection:myInviteeCollection
						}
					);
					mySeedCollection = new SeedCollection();
					seed = new SeedView(
						{
							el:"#seed",
							collection:mySeedCollection
						}
					);					
				}
			);

			/////////////////////////////////////////////////////////////////////////////////Invitee Data 
			InviteeView = Backbone.View.extend({
				initialize: function(){
					//this.collection.sync('read',this);
					this.collection.fetch();
					this.listenTo(this.collection,'reset',this.onUpdate)
					console.log (this.collection);
				},
				onUpdate:function(){
					console.log (this.collection);
					_.each(this.collection.models,function(e,i){
						var userHandle = e.attributes.handle;
						//remove @ and any spaces
						userHandle = userHandle.replace(/@/g,'');
						userHandle = userHandle.replace(/\s+/g, '');
						this.$el.append("<h4>@"+userHandle+"</h4>");
						this.$el.append('<img src="https://api.twitter.com/1/users/profile_image?screen_name='+userHandle+'&size=bigger" /><br/>');
					},this);
				}
			});
			var InviteeModel = Backbone.Model.extend({
				//urlRoot: './data/data.json'
				url: 'http://localhost:8090/data/invitee.json'
				//url: 'http://twinvite.myt:8000/api/v1/invitee/?format=json&limit=250'
			});
			var InviteeCollection = Backbone.Collection.extend({
				model: InviteeModel,
				//url : 'http://twinvite.myt:8000/api/invitee/?format=json'
				//url: 'data.json',
				url: 'http://localhost:8090/data/invitee.json'
    	});
			

			/////////////////////////////////////////////////////////////////////////////////Seed Data
			SeedView = Backbone.View.extend({
				initialize: function(){
					this.collection.fetch();
					this.listenTo(this.collection,'reset',this.onUpdate)
					console.log (this.collection);
				},
				onUpdate:function(){
					console.log (this.collection);
					_.each(this.collection.models,function(e,i){
						
						var seedHandle = e.attributes.seeder;
						seedHandle = seedHandle.replace(/@/g,'');
						seedHandle = seedHandle.replace(/\s+/g, '');
					
						this.$el.append("<h2>#"+seedHandle+"</h2>");
						this.$el.append('<img src="https://api.twitter.com/1/users/profile_image?screen_name='+seedHandle+'&size=bigger" /><br/>');
					},this);
				}
			});
			var SeedModel = Backbone.Model.extend({
				//urlRoot: './data/data.json'
				url: 'http://localhost:8090/data/seed.json'
				//url: 'http://twinvite.myt:8000/api/v1/invitee/?format=json&limit=250'
			});
			var SeedCollection = Backbone.Collection.extend({
				model: SeedModel,
				//url : 'http://twinvite.myt:8000/api/invitee/?format=json'
				//url: 'data.json',
				url: 'http://localhost:8090/data/seed.json'
    	});
		</script>
	</head>
	<body>
		<div id="invitee">
			<ul></ul>
		</div>
		<div id="seed">
			<ul></ul>
		</div>
	</body>
</html>